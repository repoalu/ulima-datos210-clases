CREATE TABLE PERSONA(
    CODIGO INTEGER PRIMARY KEY,
    NOMBRE VARCHAR2(100),
    GENERO VARCHAR2(1),
    NACIONALIDAD VARCHAR2(30)
);

CREATE TABLE PELICULA(
    CODIGO INTEGER PRIMARY KEY,
    NOMBRE VARCHAR2(100) UNIQUE NOT NULL,
    ANIO INTEGER,
    PRESUPUESTO NUMBER,
    CALIFICACION NUMBER(3,2),
    COD_DIRECTOR REFERENCES PERSONA
);

CREATE TABLE ACTOR_PELICULA(
    COD_ACTOR REFERENCES PERSONA,
    COD_PELICULA REFERENCES PELICULA,
    PRIMARY KEY(COD_ACTOR, COD_PELICULA)
);

CREATE TABLE PREMIO(
    COD_PELICULA REFERENCES PELICULA,
    NRO_PREMIO INTEGER,
    NOMBRE VARCHAR2(50) NOT NULL,
    CATEGORIA VARCHAR2(50),
    ANIO INTEGER NOT NULL,
    PAIS VARCHAR2(20)
    --PRIMARY KEY(COD_PELICULA, NRO_PREMIO)
);

--EJEMPLO ALTER TABLE
ALTER TABLE PREMIO
ADD CONSTRAINT PK_PREMIO
PRIMARY KEY(COD_PELICULA, NRO_PREMIO);

--ALTER TABLE PREMIO ADD PAIS VARCHAR2(20) NOT NULL;

CREATE TABLE GENERO(
    CODIGO INTEGER PRIMARY KEY,
    NOMBRE VARCHAR2(20)
);

CREATE TABLE GENERO_PELICULA(
    COD_PELICULA REFERENCES PELICULA,
    COD_GENERO REFERENCES GENERO,
    PORCENTAJE NUMBER(3),
    PRIMARY KEY(COD_PELICULA, COD_GENERO)
);

--REGISTRO DE PERSONAS
INSERT INTO PERSONA VALUES(1, 'LIONEL MESSI', 'M', 'ARGENTINA');
INSERT INTO PERSONA VALUES(2, 'PAOLO GUERRERO', 'M', 'PERUANA');
INSERT INTO PERSONA VALUES(3, 'JEFFERSON FARFAN', 'M', 'PERUANA');
INSERT INTO PERSONA VALUES(4, 'DIEGO FORLAN', 'M', 'URUGUAYA');
INSERT INTO PERSONA VALUES(5, 'SERENA WILLIAMS', 'F', 'ESTADOUNIDENSE');
INSERT INTO PERSONA VALUES(6, 'MERYL STREEP', 'F', 'ESTADOUNIDENSE');

--REGISTRO DE PELICULAS
INSERT INTO PELICULA VALUES(1, 'PELICULA 1', 1998, 5.3, 4.5, 3);
INSERT INTO PELICULA VALUES(2, 'PELICULA 2', 2005, 235.3, 3.2, 2);
INSERT INTO PELICULA VALUES(3, 'PELICULA 3', 2018, 323.3, 4.8, 2);
INSERT INTO PELICULA VALUES(4, 'PELICULA 4', 2014, 100.1, 2.9, 2);
INSERT INTO PELICULA VALUES(5, 'EL DIABLO VISTE A LA MODA', 2006, 70.4, 4.6, 3);
INSERT INTO PELICULA VALUES(6, 'THE POST', 2017, 12.4, 4.7, 3);

--
INSERT INTO ACTOR_PELICULA VALUES(1, 1);
INSERT INTO ACTOR_PELICULA VALUES(1, 2);
INSERT INTO ACTOR_PELICULA VALUES(4, 3);
INSERT INTO ACTOR_PELICULA VALUES(5, 3);
INSERT INTO ACTOR_PELICULA VALUES(2, 1);
INSERT INTO ACTOR_PELICULA VALUES(6, 5);
INSERT INTO ACTOR_PELICULA VALUES(6, 6);

INSERT INTO GENERO VALUES(1, 'DRAMA');
INSERT INTO GENERO VALUES(2, 'COMEDIA');
INSERT INTO GENERO VALUES(3, 'TERROR');

INSERT INTO GENERO_PELICULA VALUES(1, 3, 100);
INSERT INTO GENERO_PELICULA VALUES(2, 3, 40);
INSERT INTO GENERO_PELICULA VALUES(2, 2, 60);
INSERT INTO GENERO_PELICULA VALUES(3, 2, 100);

CREATE TABLE PREMIO(
    COD_PELICULA REFERENCES PELICULA,
    NRO_PREMIO INTEGER,
    NOMBRE VARCHAR2(50) NOT NULL,
    CATEGORIA VARCHAR2(50),
    ANIO INTEGER NOT NULL--,
    --PRIMARY KEY(COD_PELICULA, NRO_PREMIO)
);

INSERT INTO PREMIO VALUES(3, 1, 'PREMIOS OSCAR', 'MEJOR ACTOR', 2007, 'ESTADOS UNIDOS');
INSERT INTO PREMIO VALUES(3, 2, 'PREMIOS OSCAR', 'MEJOR DIRECTOR', 2007, 'ESTADOS UNIDOS');

--DIRECTORES DE NACIONALIDAD PERUANA
--1RA FORMA: SUBCONSULTA
SELECT * FROM PERSONA 
WHERE NACIONALIDAD = 'PERUANA'
AND CODIGO IN (SELECT COD_DIRECTOR FROM PELICULA);

--2DA FORMA: JOIN
SELECT DISTINCT P.*
FROM PERSONA P, PELICULA PE
WHERE P.CODIGO = PE.COD_DIRECTOR;

--ACTUALIZAR LA CALIFICACION DE LA PELICULA 2 A 2.8
UPDATE PELICULA SET CALIFICACION = 2.8 WHERE CODIGO = 2;

--ACTUALIZAR EL ANIO DE ESTRENO DE "PELICULA 3" A 2019
UPDATE PELICULA SET ANIO = 2019 WHERE NOMBRE = 'PELICULA 3';

SELECT * FROM GENERO_PELICULA WHERE COD_PELICULA = 3;

INSERT INTO GENERO_PELICULA VALUES(3, 1, 20);

UPDATE GENERO_PELICULA SET PORCENTAJE = 80
WHERE COD_PELICULA = 3
AND COD_GENERO = 2;

--3) 
SELECT * FROM PERSONA 
WHERE NACIONALIDAD = 'PERUANA'
AND CODIGO IN (SELECT COD_ACTOR FROM ACTOR_PELICULA);


--4)
SELECT * FROM PELICULA WHERE 
CALIFICACION < 3;

--5)
SELECT  PE.NOMBRE AS PELICULA,
        PE.CALIFICACION,
        P2.NOMBRE AS NOMBRE_DIRECTOR,
        P1.NOMBRE AS NOMBRE_ACTOR,
        PE.ANIO
FROM ACTOR_PELICULA AP, PERSONA P1, PERSONA P2, PELICULA PE
WHERE P1.CODIGO = AP.COD_ACTOR
AND PE.CODIGO = AP.COD_PELICULA
AND P2.CODIGO = PE.COD_DIRECTOR
AND PE.ANIO = 2019
ORDER BY PELICULA;

--6)
SELECT PE.NOMBRE AS PELICULA, PE.PRESUPUESTO, P2.NOMBRE AS DIRECTOR
FROM PERSONA P1, ACTOR_PELICULA AP, PELICULA PE, PERSONA P2
WHERE P1.CODIGO = AP.COD_ACTOR
AND PE.CODIGO = AP.COD_PELICULA
AND P1.NOMBRE = 'MERYL STREEP'
AND P2.CODIGO = PE.COD_DIRECTOR;

--7)
SELECT  PE.NOMBRE AS PELICULA,
        PE.ANIO,
        PE.CALIFICACION,
        DIR.NOMBRE AS NOMBRE_DIRECTOR,
        ACT.NOMBRE AS NOMBRE_ACTOR,
        ACT.NACIONALIDAD AS NACIONALIDAD_ACTOR,
        PR.NOMBRE AS NOMBRE_PREMIO,
        PR.CATEGORIA AS CATEGORIA_PREMIO,
        PR.ANIO AS ANIO_PREMIO,
        G2.NOMBRE AS NOMBRE_GENERO,
        GP2.PORCENTAJE AS PORCENTAJE_GENERO
FROM    GENERO_PELICULA GP,
        GENERO G, 
        PELICULA PE,
        PERSONA DIR,
        ACTOR_PELICULA AP,
        PERSONA ACT,
        PREMIO PR,
        GENERO_PELICULA GP2, --PARA OBTENER LOS GENEROS DE LA PELICULA,
        GENERO G2
WHERE G.CODIGO = GP.COD_GENERO 
AND PE.CODIGO = GP.COD_PELICULA
AND DIR.CODIGO = PE.COD_DIRECTOR
AND PE.CODIGO = AP.COD_PELICULA
AND ACT.CODIGO = AP.COD_ACTOR
AND G.NOMBRE = 'COMEDIA'
AND PR.COD_PELICULA = PE.CODIGO
AND GP2.COD_PELICULA = PE.CODIGO
AND G2.CODIGO = GP2.COD_GENERO
AND PE.ANIO > 2016;

